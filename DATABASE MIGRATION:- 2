-- Creating the 'users' table
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Creating the 'products' table
CREATE TABLE products (
    product_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Creating the 'orders' table with a foreign key reference to users
CREATE TABLE orders (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
-- Creating indexes for better query performance
CREATE INDEX idx_username ON users(username);
CREATE INDEX idx_email ON users(email);
CREATE INDEX idx_product_name ON products(name);
CREATE INDEX idx_order_user_id ON orders(user_id);
-- Data migration from the 'users' table in the source database
INSERT INTO target_db.users (user_id, username, email, created_at, updated_at)
SELECT user_id, username, email, created_at, updated_at
FROM source_db.users;

-- Data migration from the 'products' table
INSERT INTO target_db.products (product_id, name, price, created_at)
SELECT product_id, name, price, created_at
FROM source_db.products;

-- Data migration from the 'orders' table
INSERT INTO target_db.orders (order_id, user_id, order_date, total_amount)
SELECT order_id, user_id, order_date, total_amount
FROM source_db.orders;
-- Check row counts for users
SELECT COUNT(*) FROM source_db.users;
SELECT COUNT(*) FROM target_db.users;

-- Check row counts for orders
SELECT COUNT(*) FROM source_db.orders;
SELECT COUNT(*) FROM target_db.orders;
-- Compare checksums for 'users' table between source and target
SELECT MD5(GROUP_CONCAT(user_id ORDER BY user_id)) AS checksum FROM source_db.users;
SELECT MD5(GROUP_CONCAT(user_id ORDER BY user_id)) AS checksum FROM target_db.users;
# Backup the source database before migrating
mysqldump -u your_user -p source_db > source_db_backup.sql
-- Rebuild indexes to optimize query performance
OPTIMIZE TABLE users;
OPTIMIZE TABLE products;
OPTIMIZE TABLE orders;

-- Update statistics to ensure the optimizer works efficiently
ANALYZE TABLE users;
ANALYZE TABLE products;
ANALYZE TABLE orders;
-- Test a basic query for the 'users' table
SELECT * FROM target_db.users LIMIT 10;

-- Test a basic join query
SELECT u.username, o.order_date, o.total_amount
FROM target_db.users u
JOIN target_db.orders o ON u.user_id = o.user_id
ORDER BY o.order_date DESC
LIMIT 10;
